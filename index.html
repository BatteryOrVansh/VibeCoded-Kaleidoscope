<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Kaleidoscope</title>
    <!-- Tailwind CSS for styling UI elements -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- p5.js library for drawing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        main {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
        }
        /* Style for the p5.js canvas */
        canvas {
            display: block;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Custom styles for UI controls */
        .control-panel {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .control-group label {
            color: #d1d5db; /* text-gray-300 */
            font-size: 0.875rem;
        }
        /* Style for the color picker */
        input[type="color"] {
            -webkit-appearance: none;
            appearance: none;
            width: 2.5rem;
            height: 2.5rem;
            border: none;
            background-color: transparent;
            cursor: pointer;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: 2px solid #9ca3af; /* border-gray-400 */
            border-radius: 50%;
        }
        input[type="color"]:hover {
            transform: scale(1.1);
        }
        /* Style for the range slider */
        input[type="range"] {
            cursor: pointer;
        }
        /* Style for buttons */
        .action-button {
            background-color: #374151; /* bg-gray-700 */
            color: #f3f4f6; /* text-gray-100 */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .action-button:hover {
            background-color: #4b5563; /* bg-gray-600 */
        }
    </style>
</head>
<body>
    <main id="canvas-container"></main>

    <!-- UI Controls Panel -->
    <div id="controls" class="control-panel">
        <div class="control-group">
            <label for="color-picker">Color</label>
            <input type="color" id="color-picker" value="#FFFFFF">
        </div>
        <div class="control-group">
            <label for="stroke-slider">Size</label>
            <input type="range" id="stroke-slider" min="1" max="32" value="4" step="1">
        </div>
        <div class="control-group">
            <button id="clear-button" class="action-button">Clear</button>
            <button id="save-button" class="action-button">Save</button>
        </div>
    </div>

    <script>
        // --- Global Variables ---
        let symmetry = 6; // Number of symmetrical sections
        let angle;

        // --- UI Element References ---
        let colorPicker;
        let strokeSlider;
        let clearButton;
        let saveButton;

        /**
         * The setup function runs once when the program starts.
         * It's used to define initial environment properties.
         */
        function setup() {
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = createCanvas(windowWidth * 0.9, windowHeight * 0.9);
            canvas.parent(canvasContainer);

            angle = 360 / symmetry;
            angleMode(DEGREES); // Use degrees for rotation
            background(0); // Set initial background to black

            // --- Initialize UI Controls ---
            colorPicker = select('#color-picker');
            strokeSlider = select('#stroke-slider');
            clearButton = select('#clear-button');
            saveButton = select('#save-button');

            // --- Add Event Listeners ---
            clearButton.mousePressed(clearCanvas);
            saveButton.mousePressed(saveArt);
        }

        /**
         * Clears the canvas by drawing a black background.
         */
        function clearCanvas() {
            background(0);
        }

        /**
         * Saves the current canvas content as a PNG file.
         */
        function saveArt() {
            saveCanvas('kaleidoscope_art', 'png');
        }

        /**
         * The draw function continuously executes the code within it.
         * This is where the drawing and transformations happen.
         */
        function draw() {
            // Translate the origin (0,0) to the center of the canvas
            translate(width / 2, height / 2);

            // Only draw if the mouse is pressed
            if (mouseIsPressed) {
                // Get current and previous mouse positions relative to the canvas center
                const mx = mouseX - width / 2;
                const my = mouseY - height / 2;
                const pmx = pmouseX - width / 2;
                const pmy = pmouseY - height / 2;

                // Set drawing properties from UI controls
                const hu = colorPicker.value();
                const sw = strokeSlider.value();
                stroke(hu);
                strokeWeight(sw);

                // --- The Kaleidoscope Logic ---
                // Loop through each symmetrical section
                for (let i = 0; i < symmetry; i++) {
                    rotate(angle);

                    // Draw the primary line based on mouse movement
                    line(mx, my, pmx, pmy);

                    // Create a mirrored reflection within the same segment
                    // This creates the intricate symmetrical patterns
                    push(); // Save the current drawing state
                    scale(1, -1); // Flip the y-axis
                    line(mx, my, pmx, pmy); // Draw the mirrored line
                    pop(); // Restore the original drawing state
                }
            }
        }

        /**
         * This function is called automatically by p5.js whenever the
         * browser window is resized.
         */
        function windowResized() {
            // Resize the canvas to fit the new window dimensions
            resizeCanvas(windowWidth * 0.9, windowHeight * 0.9);
            // Redraw the background to prevent artifacts
            background(0);
        }
    </script>
</body>
</html>
